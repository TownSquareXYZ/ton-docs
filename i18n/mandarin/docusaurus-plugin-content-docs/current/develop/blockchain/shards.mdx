# Shards

:::warning
页面正在开发中
:::

Sharding is a mechanism in TON blockchain which allows to process a large number of transactions. The main idea of sharding in TON is that when account A sends a message to account B and account C sends a message to account D both of these operations can be performed asynchronously.

默认情况下，在基本链（`workchain=0`）中只有一个分片，其分片号为 `0x8000000000000000`（或二进制表示为 `1000000000000000000000000000000000000000000000000000000000000000`）。主链（`workchain=-1`）始终只有一个分片。 The masterchain (`workchain=-1`) always has one and only one shard.

## 拆分

Each shard is responsible for some subset of accounts with some common binary prefix. This prefix appears in shard id which presented by a 64-bit integer and has the following structure: `<binary prefix>100000...`. For example, shard with id `1011100000...` contains all accounts started with prefix `1011`.

When number of transactions in some shard growth, it splits into two shards. New shards obtaining the following ids: `<parent prefix>01000...` and `<parent prefix>11000...` and responsible for accounts starting with `<parent prefix>0` and `<parent prefix>1` correspondingly. The seqnos of blocks in shards goes continuously starting from parent last seqno plus 1. After split shards go independently and may have different seqnos.

Masterchain block contains information about shards in its header. 主链区块在其头部包含分片信息。分片区块出现在主链头部后，可以认为是完成的（不能回滚）。

示例：

- 主链块 `seqno=34607821` 有2个分片：`(0,4000000000000000,40485798)` 和 `(0,c000000000000000,40485843)` (https://toncenter.com/api/v2/shards?seqno=34607821)。
- 分片 `shard=4000000000000000` 拆分成 `shard=2000000000000000` 和 `shard=6000000000000000`，主链区块 `seqno=34607822` 已经有3个分片：`(0,2000000000000000,40485799)` 和 `(0,6000000000000000,40485799)`。注意，两个新分片具有相同的序列号，但不同的分片ID (https://toncenter.com/api/v2/shards?seqno=34607822)。 Note, that both new shards has the same seqnos but different shard IDs (https://toncenter.com/api/v2/shards?seqno=34607822).
- 新分片独立进行，经过100个主链区块（在主链块 `seqno=34607921` 中），一个分片有最后一个块 `(0,2000000000000000,40485901)`，另一个分片有 `(0,6000000000000000,40485897)` (https://toncenter.com/api/v2/shards?seqno=34607921)。

## 合并

当分片负载下降时，它们可以按如下方式合并回去：

- 如果两个分片有共同的父分片，因此，它们的分片ID分别为 `<父前缀>010...` 和 `<父前缀110...`，则可以合并。合并后的分片将具有分片ID `<父前缀>10...`（例如 `10010...` + `10110...` = `1010...`）。合并分片的第一个区块将具有 `seqno=max(seqno1, seqno2) + 1`。 Merged shard will have shard id `<parent prefix>10...` (for example `10010...` + `10110...` = `1010...`). The first block of merged shard will have `seqno=max(seqno1, seqno2) + 1`.

示例：

- 在主链区块 `seqno=34626306` 中，五个分片中的两个，最后区块为 `(0,a000000000000000,40492030)` 和 `(0,e000000000000000,40492216)`，合并成一个区块为 `(0,c000000000000000,40492217)` 的分片 (https://toncenter.com/api/v2/shards?seqno=34626306 和 https://toncenter.com/api/v2/shards?seqno=34626307)。
